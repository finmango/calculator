<!DOCTYPE html><html><!-- HTML head --><head>
    <!-- HTML metadata -->
    <meta charset="UTF-8">
    <title>FinMango Calculator</title>
    <meta name="description" content="Financial calculator, made by FinMango">
    <link rel="icon" type="image/ico" href="../../../static/favicon.ico">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="FinMango Calculator">

    <!-- Homescreen icons -->
    <link rel="apple-touch-icon" href="../../../static/favicon.ico">

    <!-- Capabilities-related metadata -->
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">

    <!-- VueJS -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
    <!-- Comment the previous line and uncomment this one to enable debug more for VueJS -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script> -->

    <!-- Google Charts -->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

    <!-- MomentJS -->
    <script type="text/javascript" src="../../../third_party/moment/min/moment.min.js"></script>

    <!-- Custom styles and fonts -->
    <link rel="stylesheet" href="https://fonts.cdnfonts.com/css/goldman-sans">
    <link rel="stylesheet" href="../../../third_party/picnic/picnic.min.css">
    <link rel="stylesheet" href="../../../static/styles.min.css">

    <!-- Polyfills, custom functions and constants -->
    <script type="text/javascript" src="../../../static/formatter.min.js"></script>
    <script type="text/javascript" src="../../../static/data-helper.min.js"></script>
    <script type="text/javascript" src="../../../static/polyfills.min.js"></script>
    <script type="text/javascript">const DEFAULT_OPTIONS={font:"Goldman Sans",chart_legend_position:"none",chart_padding_top:24,chart_padding_left:64,chart_padding_bottom:48};CURRENT_OPTIONS=Object.keys(DEFAULT_OPTIONS).reduce((t,e)=>Object.assign(t,{[e]:sessionStorage.getItem(e)||DEFAULT_OPTIONS[e]}),{}),GOOGLE_CHARTS_CONFIG=window.GOOGLE_CHARTS_CONFIG||{theme:"material",fontName:CURRENT_OPTIONS.font,colors:["{{theme-primary}}"],legend:{position:CURRENT_OPTIONS.chart_legend_position},chartArea:{width:"100%",height:"100%",top:parseInt(CURRENT_OPTIONS.chart_padding_top||24),left:parseInt(CURRENT_OPTIONS.chart_padding_left||64),bottom:parseInt(CURRENT_OPTIONS.chart_padding_bottom||48)},titlePosition:"in",axisTitlesPosition:"in",hAxis:{textPosition:"bottom",textStyle:{fontName:CURRENT_OPTIONS.font}},vAxis:{textPosition:"out",viewWindow:{min:0},textStyle:{fontName:CURRENT_OPTIONS.font}},height:parseInt(CURRENT_OPTIONS.chart_height||300)};</script>

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-xxxx-4"></script>
<script async>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-xxxx-4");</script>


<!-- Load analytics at the end of the head element before the body -->


</head><body>
    <!-- Page header-->
    <header class="flex center one">
    <div>
        <a class="centered uppercase" target="_blank" href="https://finmango.org" style="display: block; padding: 0;">
            <img class="centered" src="../../../static/logo.png" height="128" width="auto">
        </a>
    </div>
</header>

    <!-- Main element -->
    <main class="single-column-wide" style="margin-top: auto; margin-bottom: auto;">
        <div>
    <!-- Import CSV parser -->
    <script src="https://unpkg.com/papaparse@latest/papaparse.min.js"></script>

    <div id="portfolio-calculator-data">

        <div>
            <h2 v-if="error_message" class="centered" style="text-transform: uppercase;">{{error_message}}</h2>
            <h2 v-else class="centered" style="text-transform: uppercase;">
                The total returns for the simulated period are {{ Formatter.percent(portfolio_returns) }}
            </h2>
        </div>

        <!-- Summary simulation statistics -->
        <table :class="{invisible: error_message !== null}" class="centered" style="display: table; font-size: small">
            <tbody><tr>
                <th>Period</th>
                <th>Average</th>
                <th>Max</th>
                <th>Min</th>
            </tr>
            <tr v-show="portfolio_performance['1 Year'].avg">
                <td>1 Year</td>
                <td>{{ Formatter.percent(portfolio_performance['1 Year'].avg, true) }}</td>
                <td>{{ Formatter.percent(portfolio_performance['1 Year'].max, true) }}</td>
                <td>{{ Formatter.percent(portfolio_performance['1 Year'].min, true) }}</td>
            </tr>
            <tr v-show="portfolio_performance['5 Year'].avg">
                <td>5 Years</td>
                <td>{{ Formatter.percent(portfolio_performance['5 Year'].avg, true) }}</td>
                <td>{{ Formatter.percent(portfolio_performance['5 Year'].max, true) }}</td>
                <td>{{ Formatter.percent(portfolio_performance['5 Year'].min, true) }}</td>
            </tr>
            <tr v-show="portfolio_performance['10 Year'].avg">
                <td>10 Years</td>
                <td>{{ Formatter.percent(portfolio_performance['10 Year'].avg, true) }}</td>
                <td>{{ Formatter.percent(portfolio_performance['10 Year'].max, true) }}</td>
                <td>{{ Formatter.percent(portfolio_performance['10 Year'].min, true) }}</td>
            </tr>
        </tbody></table>

        <!-- Element host for the Google Charts -->
        <div :class="{invisible: error_message !== null}" id="perf-chart-container" class="chart-container"></div>
        <div :class="{invisible: error_message !== null}" id="drawdown-chart-container" class="chart-container"></div>

        <div class="spacer"></div>

        <details>
            <summary>Calculator Options</summary>

            <form class="flex one two-600">

                <div>
    <label for="rebalance_schedule">Rebalancing Schedule</label>
    <select id="rebalance_schedule" v-model="rebalance_schedule">
        <option value="never" selected>Never</option>
        <option value="yearly">Yearly</option>
        <option value="quarterly">Quarterly</option>
        <option value="monthly">Monthly</option>
        <option value="daily">Daily</option>
    </select>
</div>

                <div>
    <label for="dca_schedule">Dollar-Cost Averaging Schedule</label>
    <select id="dca_schedule" v-model="dca_schedule">
        <option value="never" selected>Never</option>
        <option value="yearly">Yearly</option>
        <option value="quarterly">Quarterly</option>
        <option value="monthly">Monthly</option>
    </select>
</div>
<div v-show="dca_schedule !== 'never'">
    <label for="dca_percent">Percentage of Initial Investment</label>
    <span class="centered" style="font-size: small;">
        Percentage of the initial investment being added to your portfolio at regular intervals.
        For example, if the initial investment was $100 and you plan on adding $10 monthly,
        enter 10%.
    </span>
    <input id="dca_percent" v-model="dca_percent" type="number" pattern="/d*" min="0" max="100" value="0">
</div>

                <div>
    <label for="dividend_reinvestment">Reinvest Dividends</label>
    <select id="dividend_reinvestment" v-model="dividend_reinvestment">
        <option value="yes" selected>Yes</option>
        <option value="no">No</option>
    </select>
</div>

                <div>
                    <label for="start_date">Simulation Start Date</label>
                    <input type="date" v-model="start_date" min="1975-01-01" @change="update()">
                </div>

                <div>
                    <label for="start_date">Simulation End Date</label>
                    <input type="date" v-model="end_date" min="1975-01-01" @change="update()">
                </div>

                <div>
                    <label for="target_allocations">Target Allocations</label>
                    <div id="target_allocations">
                        <div v-for="(value, symbol) in target_allocations">
                            <label for="{{ symbol }}">
                                <small>{{ target_allocations[symbol] }}% {{ symbol }}</small>
                            </label>
                            <input @input="temp()" type="range" v-model.number="target_allocations[symbol]" min="0" max="100" step="5">
                        </div>
                    </div>
                </div>

            </form>
        </details>
    </div>

    <script async>function csv2json(e){return new Promise(t=>Papa.parse(e,{download:!0,complete:t})).then(e=>e.data).then(e=>e.slice(1).map(t=>e[0].reduce((e,a,o)=>Object.assign(e,{[a]:"Date"===a?t[o]:parseFloat(t[o])}),{})))}const rootElement=document.currentScript.parentElement,app=new Vue({el:"#portfolio-calculator-data",data:{error_message:null,target_allocations:{},rebalance_schedule:"yearly",schedules:["Never","Yearly","Quarterly","Monthly","Daily"],dividend_reinvestment:"yes",dca_schedule:"never",dca_percent:0,start_date:"1995-01-01",end_date:(new Date).toISOString().slice(0,10),portfolio_returns:0,portfolio_performance:{"1 Year":{},"5 Year":{},"10 Year":{}},debouncer:null,Formatter:Formatter},computed:{},watch:{},methods:{alloc:function(){const e={};for(const[t,a]of Object.entries(data.target_allocations))a>0&&(e[t]=a/100);return e},temp:function(){this.debouncer&&clearTimeout(this.debouncer),this.debouncer=setTimeout(()=>{const e=this.target_allocations;this.target_allocations=null,this.target_allocations=e},10)},rebalance:function(e){const t=this.alloc(),a=Object.keys(t).reduce((t,a)=>t+e[a],0);Object.entries(t).forEach(([t,o])=>e[t]=a*o)},meetsSchedule:function(e,t){const a=e=>1+Math.floor((Number(e)-1)/3),o=e=>e.toISOString().slice(0,10).split("-");if("never"===t||e.length<2)return!1;if("yearly"===t)return o(e.at(-1).Date)[0]!==o(e.at(-2).Date)[0];if("quarterly"===t)return a(o(e.at(-1).Date)[1])!==a(o(e.at(-2).Date)[1]);if("monthly"===t)return o(e.at(-1).Date)[1]!==o(e.at(-2).Date)[1];if("daily"===t)return!0;if(t.endsWith("% threshold")){const a=parseInt(t.split("%")[0])/100,o=this.alloc.map(t=>[t,e.at(-1)[t]]),r=o.reduce((e,[t,a])=>e+a,0);for(const[e,t]of o){const o=t/r,n=this.alloc[e];Math.abs(o-n);if(Math.abs(o-n)/n>a)return!0}return!1}throw new Error(`Unknown rebalancing strategy: ${t}`)},update:async function(){const e=this.alloc();if(1!==Object.values(e).reduce((e,t)=>e+t,0))return void(this.error_message="Total allocations must be equal to 100%");this.error_message=null,await google.charts.load("current",{packages:["corechart"]});const t=Object.keys(e).sort((t,a)=>e[t]-e[a]),a="yes"===this.dividend_reinvestment,o=(await(a?this.daily_returns_reinvested:this.daily_returns)).filter(e=>e.Date.localeCompare(this.start_date)>=0).filter(e=>e.Date.localeCompare(this.end_date)<=0).filter(e=>t.every(t=>!isNaN(e[t]))),r=[],n={"1 Year":[],"5 Year":[],"10 Year":[],Rebalances:0},s=Object.assign({Total:1,Max:1},e);for(const e of o){if(s.Total=t.reduce((e,t)=>e+s[t],0),s.Max=Math.max(s.Max,s.Total),s.Drawdown=Math.min(0,(s.Total-s.Max)/s.Max),t.forEach(t=>s[t]*=1+e[t]),r.push(Object.assign({Date:new Date(e.Date)},s)),this.meetsSchedule(r,this.dca_schedule.toLowerCase())){const e=this.alloc();Object.entries(e).forEach(([e,a])=>s[e]+=this.dca_percent/100/t.length)}this.meetsSchedule(r,this.rebalance_schedule.toLowerCase())&&(n.Rebalances++,this.rebalance(s)),[1,5,10].forEach(e=>{const t=`${e} Year`,a=365*e;if(r.length>a){const e=r.at(-a),o=(s.Total-e.Total)/e.Total;n[t].push(o)}})}this.portfolio_returns=Math.round(100*(s.Total-1))/100,[1,5,10].forEach(e=>{const t=`${e} Year`,a=n[t].reduce((e,t)=>e+t,0),o=e=>Math.round(1e3*e)/1e3;this.portfolio_performance[t].avg=o(a/n[t].length),this.portfolio_performance[t].max=o(Math.max(...n[t])),this.portfolio_performance[t].min=o(Math.min(...n[t]))}),console.log(r),console.log(n);const l=t.map(e=>`${this.target_allocations[e]}% ${e}`).join(" · "),i=new google.visualization.DataTable;i.addColumn({label:"Date",type:"date"}),t.forEach(e=>i.addColumn({label:e,type:"number"})),i.addRows(r.map(e=>["Date"].concat(t).map(t=>e[t])));const c=new google.visualization.DataTable;c.addColumn({label:"Date",type:"date"}),c.addColumn({label:"Drawdown",type:"number"}),c.addRows(r.map(e=>[e.Date,e.Drawdown]));const d=rootElement.querySelector("#perf-chart-container");new google.visualization.AreaChart(d).draw(i,Object.assign({},GOOGLE_CHARTS_CONFIG,{title:`${l} Performance`,curveType:"function",isStacked:!0,focusTarget:"category",colors:null,hAxis:{format:"MM/yyyy",gridlines:{count:50},...GOOGLE_CHARTS_CONFIG.hAxis},interpolateNulls:!0}));const u=rootElement.querySelector("#drawdown-chart-container");new google.visualization.AreaChart(u).draw(c,Object.assign({},GOOGLE_CHARTS_CONFIG,{title:`${l} Drawdown`,curveType:"function",focusTarget:"category",colors:["red"],hAxis:{format:"MM/yyyy",gridlines:{count:50},...GOOGLE_CHARTS_CONFIG.hAxis},vAxis:{...GOOGLE_CHARTS_CONFIG.vAxis,viewWindow:{max:0,min:-1}},interpolateNulls:!0})),d.style.backgroundImage="none"}}}),data=DataHelper.getQueryData(window.location);data.target_allocations=(data.target_allocations||"SPY:100").split(",").reduce((e,t)=>{const[a,o]=t.split(":",2);return Object.assign(e,{[a]:parseInt(o)||0})},{}),Object.assign(app,data);const urlBase="https://finmango.github.io/portfolio-simulator";app.daily_returns=csv2json(`${urlBase}/daily-returns.csv`),app.daily_returns_reinvested=csv2json(`${urlBase}/daily-returns-with-dividends-reinvested.csv`),app.daily_returns.then(e=>Object.keys(e[0]).filter(e=>"Date"!==e).forEach(e=>data.target_allocations[e]=data.target_allocations[e]||0)),Object.keys(data).forEach(e=>app.$watch(e,function(){this.update()},{deep:!0})),app.update();</script>
</div>
    </main>


</body></html>